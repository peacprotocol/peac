{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "0.9.29",
  "description": "PEAC error codes - normative source of truth",
  "errors": [
    {
      "code": "E_INVALID_SIGNATURE",
      "http_status": 400,
      "title": "Invalid Signature",
      "description": "Receipt signature verification failed",
      "retriable": false,
      "category": "verification"
    },
    {
      "code": "E_INVALID_FORMAT",
      "http_status": 400,
      "title": "Invalid Format",
      "description": "Receipt does not conform to JWS format",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_EXPIRED",
      "http_status": 400,
      "title": "Receipt Expired",
      "description": "Receipt has exceeded its expiration time",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_NOT_YET_VALID",
      "http_status": 400,
      "title": "Not Yet Valid",
      "description": "Receipt nbf (not before) time is in the future",
      "retriable": true,
      "category": "validation"
    },
    {
      "code": "E_INVALID_ISSUER",
      "http_status": 400,
      "title": "Invalid Issuer",
      "description": "Receipt issuer claim is invalid or untrusted",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_AUDIENCE",
      "http_status": 400,
      "title": "Invalid Audience",
      "description": "Receipt audience claim does not match expected value",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_JWKS_FETCH_FAILED",
      "http_status": 503,
      "title": "JWKS Fetch Failed",
      "description": "Failed to fetch public keys from JWKS endpoint",
      "retriable": true,
      "category": "infrastructure"
    },
    {
      "code": "E_KEY_NOT_FOUND",
      "http_status": 400,
      "title": "Key Not Found",
      "description": "Public key with specified kid not found in JWKS",
      "retriable": false,
      "category": "verification"
    },
    {
      "code": "E_INVALID_AMOUNT",
      "http_status": 400,
      "title": "Invalid Amount",
      "description": "Payment amount is invalid or out of allowed range",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_CURRENCY",
      "http_status": 400,
      "title": "Invalid Currency",
      "description": "Currency code is not a valid ISO 4217 code",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_RAIL",
      "http_status": 400,
      "title": "Invalid Payment Rail",
      "description": "Payment rail identifier is not recognized",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_MISSING_REQUIRED_CLAIM",
      "http_status": 400,
      "title": "Missing Required Claim",
      "description": "Receipt is missing a required JWT claim",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_RATE_LIMITED",
      "http_status": 429,
      "title": "Rate Limited",
      "description": "Too many requests, please retry later",
      "retriable": true,
      "category": "infrastructure"
    },
    {
      "code": "E_CIRCUIT_BREAKER_OPEN",
      "http_status": 503,
      "title": "Circuit Breaker Open",
      "description": "Service temporarily unavailable due to circuit breaker",
      "retriable": true,
      "category": "infrastructure"
    },
    {
      "code": "E_CONTROL_DENIED",
      "http_status": 403,
      "title": "Control Decision Denied",
      "description": "Control engine denied authorization",
      "retriable": false,
      "category": "control"
    },
    {
      "code": "E_CONTROL_REVIEW_REQUIRED",
      "http_status": 202,
      "title": "Review Required",
      "description": "Control engine requires manual review",
      "retriable": true,
      "category": "control"
    },
    {
      "code": "E_EVIDENCE_NOT_JSON",
      "http_status": 400,
      "title": "Evidence Not JSON-Safe",
      "description": "Evidence contains non-JSON-safe values (NaN, Infinity, undefined, BigInt, Date, Map, Set, functions, symbols, class instances, or cycles)",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_SUBJECT",
      "http_status": 400,
      "title": "Invalid Subject",
      "description": "Receipt subject claim does not match expected value",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_RECEIPT_ID",
      "http_status": 400,
      "title": "Invalid Receipt ID",
      "description": "Receipt ID (rid) does not match expected value",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_MISSING_EXP",
      "http_status": 400,
      "title": "Missing Expiration",
      "description": "Receipt is missing required exp claim",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INTERNAL",
      "http_status": 500,
      "title": "Internal Error",
      "description": "An unexpected internal error occurred during verification",
      "retriable": true,
      "category": "infrastructure"
    },
    {
      "code": "E_IDENTITY_MISSING",
      "http_status": 401,
      "title": "Identity Missing",
      "description": "No agent identity attestation provided in request",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_INVALID_FORMAT",
      "http_status": 400,
      "title": "Identity Invalid Format",
      "description": "Agent identity attestation does not conform to schema",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_EXPIRED",
      "http_status": 401,
      "title": "Identity Expired",
      "description": "Agent identity attestation has exceeded its expiration time",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_NOT_YET_VALID",
      "http_status": 401,
      "title": "Identity Not Yet Valid",
      "description": "Agent identity attestation issued_at time is in the future",
      "retriable": true,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_SIG_INVALID",
      "http_status": 401,
      "title": "Identity Signature Invalid",
      "description": "Agent identity proof signature verification failed",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_KEY_UNKNOWN",
      "http_status": 401,
      "title": "Identity Key Unknown",
      "description": "Key ID not found in agent key directory",
      "retriable": true,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_KEY_EXPIRED",
      "http_status": 401,
      "title": "Identity Key Expired",
      "description": "Agent signing key has expired per directory metadata",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_KEY_REVOKED",
      "http_status": 401,
      "title": "Identity Key Revoked",
      "description": "Agent signing key has been explicitly revoked",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_BINDING_MISMATCH",
      "http_status": 400,
      "title": "Identity Binding Mismatch",
      "description": "Identity binding does not match the request being verified",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_BINDING_STALE",
      "http_status": 401,
      "title": "Identity Binding Stale",
      "description": "Identity binding is too old and requires fresh binding",
      "retriable": true,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_BINDING_FUTURE",
      "http_status": 400,
      "title": "Identity Binding Future",
      "description": "Identity binding signed_at timestamp is in the future",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_PROOF_UNSUPPORTED",
      "http_status": 400,
      "title": "Identity Proof Unsupported",
      "description": "Agent identity proof method is not supported",
      "retriable": false,
      "category": "identity"
    },
    {
      "code": "E_IDENTITY_DIRECTORY_UNAVAILABLE",
      "http_status": 503,
      "title": "Identity Directory Unavailable",
      "description": "Failed to fetch agent key directory",
      "retriable": true,
      "category": "identity"
    },
    {
      "code": "E_ATTRIBUTION_MISSING_SOURCES",
      "http_status": 400,
      "title": "Attribution Missing Sources",
      "description": "Attribution attestation has empty sources array",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_INVALID_FORMAT",
      "http_status": 400,
      "title": "Attribution Invalid Format",
      "description": "Attribution attestation does not conform to schema",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_INVALID_REF",
      "http_status": 400,
      "title": "Attribution Invalid Reference",
      "description": "Receipt reference format is invalid (must be jti:{id}, URL, or URN)",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_HASH_INVALID",
      "http_status": 400,
      "title": "Attribution Hash Invalid",
      "description": "Content hash structure is invalid (wrong algorithm, encoding, or value length)",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_UNKNOWN_USAGE",
      "http_status": 400,
      "title": "Attribution Unknown Usage",
      "description": "Attribution usage type is not recognized",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_INVALID_WEIGHT",
      "http_status": 400,
      "title": "Attribution Invalid Weight",
      "description": "Attribution weight is out of valid range (must be 0.0-1.0)",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_CIRCULAR_CHAIN",
      "http_status": 400,
      "title": "Attribution Circular Chain",
      "description": "Circular reference detected in attribution chain",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_CHAIN_TOO_DEEP",
      "http_status": 400,
      "title": "Attribution Chain Too Deep",
      "description": "Attribution chain exceeds maximum allowed depth (8)",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_TOO_MANY_SOURCES",
      "http_status": 400,
      "title": "Attribution Too Many Sources",
      "description": "Attribution has too many sources (maximum 100)",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_SIZE_EXCEEDED",
      "http_status": 400,
      "title": "Attribution Size Exceeded",
      "description": "Attribution attestation exceeds maximum size (64KB)",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_RESOLUTION_FAILED",
      "http_status": 502,
      "title": "Attribution Resolution Failed",
      "description": "Failed to resolve receipt reference in attribution chain",
      "retriable": true,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_RESOLUTION_TIMEOUT",
      "http_status": 504,
      "title": "Attribution Resolution Timeout",
      "description": "Timeout while resolving receipt reference in attribution chain",
      "retriable": true,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_NOT_YET_VALID",
      "http_status": 401,
      "title": "Attribution Not Yet Valid",
      "description": "Attribution attestation issued_at time is in the future",
      "retriable": true,
      "category": "attribution"
    },
    {
      "code": "E_ATTRIBUTION_EXPIRED",
      "http_status": 401,
      "title": "Attribution Expired",
      "description": "Attribution attestation has exceeded its expiration time",
      "retriable": false,
      "category": "attribution"
    },
    {
      "code": "E_DISPUTE_INVALID_FORMAT",
      "http_status": 400,
      "title": "Dispute Invalid Format",
      "description": "Dispute attestation does not conform to schema",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_INVALID_ID",
      "http_status": 400,
      "title": "Dispute Invalid ID",
      "description": "Dispute ID is not a valid ULID format (26 uppercase alphanumeric characters)",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_INVALID_TYPE",
      "http_status": 400,
      "title": "Dispute Invalid Type",
      "description": "Dispute type is not recognized",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_INVALID_TARGET_TYPE",
      "http_status": 400,
      "title": "Dispute Invalid Target Type",
      "description": "Dispute target type is not recognized (must be receipt, attribution, identity, or policy)",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_INVALID_GROUNDS",
      "http_status": 400,
      "title": "Dispute Invalid Grounds",
      "description": "Dispute grounds code is not recognized",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_INVALID_STATE",
      "http_status": 400,
      "title": "Dispute Invalid State",
      "description": "Dispute state is not recognized",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_INVALID_TRANSITION",
      "http_status": 400,
      "title": "Dispute Invalid Transition",
      "description": "Invalid state transition for dispute lifecycle",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_MISSING_RESOLUTION",
      "http_status": 400,
      "title": "Dispute Missing Resolution",
      "description": "Resolution is required for terminal states (resolved, rejected, final)",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_RESOLUTION_NOT_ALLOWED",
      "http_status": 400,
      "title": "Dispute Resolution Not Allowed",
      "description": "Resolution is only valid for terminal states",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_NOT_YET_VALID",
      "http_status": 401,
      "title": "Dispute Not Yet Valid",
      "description": "Dispute attestation issued_at time is in the future",
      "retriable": true,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_EXPIRED",
      "http_status": 401,
      "title": "Dispute Expired",
      "description": "Dispute attestation has exceeded its expiration time",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_OTHER_REQUIRES_DESCRIPTION",
      "http_status": 400,
      "title": "Dispute Other Requires Description",
      "description": "Dispute type 'other' requires description of at least 50 characters",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_DUPLICATE",
      "http_status": 409,
      "title": "Dispute Duplicate",
      "description": "A dispute with this ID already exists",
      "retriable": false,
      "category": "dispute"
    },
    {
      "code": "E_DISPUTE_TARGET_NOT_FOUND",
      "http_status": 404,
      "title": "Dispute Target Not Found",
      "description": "The target receipt, attribution, or identity being disputed was not found",
      "retriable": true,
      "category": "dispute"
    },
    {
      "code": "E_BUNDLE_INVALID_FORMAT",
      "http_status": 400,
      "title": "Bundle Invalid Format",
      "description": "Bundle archive structure is invalid (not a valid ZIP or missing required files)",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_MANIFEST_MISSING",
      "http_status": 400,
      "title": "Bundle Manifest Missing",
      "description": "manifest.json not found at bundle archive root",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_MANIFEST_INVALID",
      "http_status": 400,
      "title": "Bundle Manifest Invalid",
      "description": "manifest.json does not conform to schema or contains invalid values",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_HASH_MISMATCH",
      "http_status": 400,
      "title": "Bundle Hash Mismatch",
      "description": "File hash does not match value declared in manifest.json",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_SIGNATURE_INVALID",
      "http_status": 400,
      "title": "Bundle Signature Invalid",
      "description": "bundle.sig JWS verification failed over manifest hash",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_RECEIPTS_UNORDERED",
      "http_status": 400,
      "title": "Bundle Receipts Unordered",
      "description": "receipts.ndjson is not in deterministic order (issued_at, receipt_id, receipt_hash)",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_POLICY_HASH_MISMATCH",
      "http_status": 400,
      "title": "Bundle Policy Hash Mismatch",
      "description": "Policy snapshot hash does not match policy used to evaluate receipts",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_KEY_MISSING",
      "http_status": 400,
      "title": "Bundle Key Missing",
      "description": "Required signing key not found in bundle (offline verification mode)",
      "retriable": false,
      "category": "bundle"
    },
    {
      "code": "E_BUNDLE_TIME_RANGE_INVALID",
      "http_status": 400,
      "title": "Bundle Time Range Invalid",
      "description": "Receipt issued_at is outside the bundle declared time_range",
      "retriable": false,
      "category": "bundle"
    }
  ]
}
