{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "0.9.21",
  "description": "PEAC error codes - normative source of truth",
  "errors": [
    {
      "code": "E_INVALID_SIGNATURE",
      "http_status": 400,
      "title": "Invalid Signature",
      "description": "Receipt signature verification failed",
      "retriable": false,
      "category": "verification"
    },
    {
      "code": "E_INVALID_FORMAT",
      "http_status": 400,
      "title": "Invalid Format",
      "description": "Receipt does not conform to JWS format",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_EXPIRED",
      "http_status": 400,
      "title": "Receipt Expired",
      "description": "Receipt has exceeded its expiration time",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_NOT_YET_VALID",
      "http_status": 400,
      "title": "Not Yet Valid",
      "description": "Receipt nbf (not before) time is in the future",
      "retriable": true,
      "category": "validation"
    },
    {
      "code": "E_INVALID_ISSUER",
      "http_status": 400,
      "title": "Invalid Issuer",
      "description": "Receipt issuer claim is invalid or untrusted",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_AUDIENCE",
      "http_status": 400,
      "title": "Invalid Audience",
      "description": "Receipt audience claim does not match expected value",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_JWKS_FETCH_FAILED",
      "http_status": 503,
      "title": "JWKS Fetch Failed",
      "description": "Failed to fetch public keys from JWKS endpoint",
      "retriable": true,
      "category": "infrastructure"
    },
    {
      "code": "E_KEY_NOT_FOUND",
      "http_status": 400,
      "title": "Key Not Found",
      "description": "Public key with specified kid not found in JWKS",
      "retriable": false,
      "category": "verification"
    },
    {
      "code": "E_INVALID_AMOUNT",
      "http_status": 400,
      "title": "Invalid Amount",
      "description": "Payment amount is invalid or out of allowed range",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_CURRENCY",
      "http_status": 400,
      "title": "Invalid Currency",
      "description": "Currency code is not a valid ISO 4217 code",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_INVALID_RAIL",
      "http_status": 400,
      "title": "Invalid Payment Rail",
      "description": "Payment rail identifier is not recognized",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_MISSING_REQUIRED_CLAIM",
      "http_status": 400,
      "title": "Missing Required Claim",
      "description": "Receipt is missing a required JWT claim",
      "retriable": false,
      "category": "validation"
    },
    {
      "code": "E_RATE_LIMITED",
      "http_status": 429,
      "title": "Rate Limited",
      "description": "Too many requests, please retry later",
      "retriable": true,
      "category": "infrastructure"
    },
    {
      "code": "E_CIRCUIT_BREAKER_OPEN",
      "http_status": 503,
      "title": "Circuit Breaker Open",
      "description": "Service temporarily unavailable due to circuit breaker",
      "retriable": true,
      "category": "infrastructure"
    },
    {
      "code": "E_CONTROL_DENIED",
      "http_status": 403,
      "title": "Control Decision Denied",
      "description": "Control engine denied authorization",
      "retriable": false,
      "category": "control"
    },
    {
      "code": "E_CONTROL_REVIEW_REQUIRED",
      "http_status": 202,
      "title": "Review Required",
      "description": "Control engine requires manual review",
      "retriable": true,
      "category": "control"
    },
    {
      "code": "E_EVIDENCE_NOT_JSON",
      "http_status": 400,
      "title": "Evidence Not JSON-Safe",
      "description": "Evidence contains non-JSON-safe values (NaN, Infinity, undefined, BigInt, Date, Map, Set, functions, symbols, class instances, or cycles)",
      "retriable": false,
      "category": "validation"
    }
  ]
}
