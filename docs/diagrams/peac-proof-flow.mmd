%%{init: {'theme':'neutral'} }%%
flowchart LR
  A["Client / AI agent"]:::actor
  S["Service / API (issuer)"]:::actor
  V["Offline verifier"]:::actor
  T["Third party (audit / dispute)"]:::actor

  P["Policy<br/>/.well-known/peac.txt"]:::artifact
  K["Issuer keys<br/>/.well-known/peac-issuer.json (JWKS)"]:::artifact
  R["Receipt<br/>JWS (typ: peac-receipt/0.1)<br/>HTTP: PEAC-Receipt: &lt;jws&gt;"]:::artifact
  B["Dispute Bundle<br/>ZIP (peac-bundle/0.1)<br/>receipts + policy + report"]:::evidence

  %% Setup (out of band)
  S -->|publish terms| P
  S -->|publish verification keys| K

  %% Runtime (per interaction)
  A -->|1) discover policy| P
  A -->|2) request (API / tool / download)| S
  S -->|3) response (includes PEAC-Receipt header)| A
  A -->|extract receipt| R
  R -->|4) verify signature + claims| V
  P -.->|policy context| V
  K -.->|public keys| V
  V -->|5) export portable evidence| B
  B -->|audit / dispute / incident review| T

  classDef actor stroke-width:2px
  classDef artifact stroke-width:2px
  classDef evidence stroke-width:2px
